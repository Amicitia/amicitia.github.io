<!doctype html>
<html>
<head>
<link rel='shortcut icon' href='../../favicon.png' type='image/x-icon'/ >
<meta charset="utf-8">
<title>Amicitia - P5 Script Editing Guide</title>
<link href="../../css/index.css" rel="stylesheet" type="text/css">
<link href="../../css/waves.css" rel="stylesheet" type="text/css">
<link href="../../css/guides.css" rel="stylesheet" type="text/css">
<script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
</head>
<body>
<canvas id='bgCanvas'></canvas>
<script src="../../js/bubbles.js"></script>
<div class="waves">
  <div class="wave wave_1"></div>
  <div class="wave wave_2"></div>
  <div class="wave wave_3"></div>
</div>
<div class="navigation">
 <i class="fas fa-home"></i> Home
 <a href="http://amicitia-team.tumblr.com"><i class="fas fa-edit"></i> Blog</a>
 <a href="http://amicitia-mods.boards.net/"><i class="fa fa-comment" aria-hidden="true"></i> Forum</a>
 <a href="https://amicitia.miraheze.org/wiki/Main_Page"><i class="fa fa-book" aria-hidden="true"></i> Wiki</a>
 <a href="https://amicitia.github.io/about"><i class="fa fa-info-circle" aria-hidden="true"></i> About</a>
 
</div>
<div class="logo"><center><a href="https://amicitia.github.io/"><img src="../../images/logo.svg" width="179" height="179"></a></center></div>

<div class="content"><a href="https://amicitia.github.io/index">Home</a> <i class="fa fa-angle-double-right" aria-hidden="true"></i>
 <a href="https://amicitia.github.io/guides">Guides</a> <i class="fa fa-angle-double-right" aria-hidden="true"></i>
 <a href="../p5">Persona 5 (PS3)</a> <i class="fa fa-angle-double-right" aria-hidden="true"></i> <b>P5 Script Editing Guide</b>
 
 <b><h1>Understanding Atlus Scripts</h1></b>
 <table border="0" cellspacing="20" cellpadding="0" id="entry">
	<tr>
		<td><img src="http://68.media.tumblr.com/3567b658ed173636de9bca6438a16fcd/tumblr_inline_opcy07LYXL1rp7sxh_500.png"></td>
		<td id="left"><h2>About BF/BMD</h2>
			A <span style="background-color: #CCE8FF">BF</span> file is a script that has already been compiled
			into a binary file by Atlus during development. BF scripts can control several different things,
			such as enemy AI, cutscenes, NPC dialog, and menus. 
			<br><br>A BF file may also contain a <span style="background-color: #CCE8FF">BMD</span>, which deals more with text and message scripting rather than the logical flow of an event.
			<br>
			<br>If you want to modify either of these files extensively, you must first <a href="https://amicitia.github.io/mods/p5#modloader"><b>download TGE's decompiler</b></a>. This converts compiled BF scripts to <span style="background-color: #CCE8FF">.flow</span> scripts, which we can edit and convert back to BF. Additionally, it can be used to convert BMD scripts to/from an editable <span style="background-color: #CCE8FF">.msg</span> format.
		</td>
	</tr>
</table>
</div>

<div class="content">
 <b><h1>Decompiling and Editing</h1></b>
 <table border="0" cellspacing="20" cellpadding="0" id="entry">
	<tr>
		<td>
			Once you have downloaded and extracted TGE's compiler, open the Windows command prompt. 
			<br>Provide the path to the compiler's EXE and then the BF or BMD file you want to convert. Then supply the following arguments (which you can copy/paste if you'd like).
			<br><span style="background-color: #CCE8FF">AtlusScriptCompiler.exe input.bf <b>-Decompile -Library P5 -Encoding P5</b></span>
			<br><br>Press enter, and if you followed the directions correctly (it should look like the screenshot to the right) new <span style="background-color: #CCE8FF">.msg</span> and <span style="background-color: #CCE8FF">.flow</span> files should appear in the same directory as the original BF/BMD file you specified.
		</td>
		<td>
			<img src="http://i.imgur.com/Ct2gRJb.png">
		</td>
	<tr>
		<td><img src="http://i.imgur.com/awRqj6W.png"></td>
		<td id="left">For editing the flowscript file, I recommend <a href="https://notepad-plus-plus.org/">Notepad++</a>. 
		<br>For better syntax highlighting (that will make this a lot easier to read), go to the Language menu at the top of the window and select <span style="background-color: #CCE8FF">C#</span>.
		</td>
	</tr>
	<tr>
		<td>
			<h1>A quick breakdown</h1>
			Although <b>basic programming experience is recommended</b> before you continue, editing scripts is a lot easier for a beginner than making new ones from scratch. Decompile as many different BF scripts as you'd like and check out the flowscripts for ideas and inspiration.
			<br><br>Once you're familiar with the following concepts, you'll be making your own scripts in no time.
			<h2>Importing scripts</h2>
			<br>At the beginning of a flowscript, you might see a statement like this:
			<br><span style="background-color: #CCE8FF">import( "field.msg" );</span>
			<br>This is an <b>import statement</b>. This one means that the file <span style="background-color: #CCE8FF">field.msg</span> will be compiled with the flowscript as a BMD when you're ready to turn it back into a BF. You can add import statements like these to link multiple scripts together as well, including new ones:
			<br><span style="background-color: #CCE8FF">import( "field.msg" );</span>
			<br><span style="background-color: #CCE8FF">import( "TestScript.flow" );</span>
			<br><span style="background-color: #CCE8FF">import( "TestScript.msg" );</span>
			<br>In this example, when you compile field.flow, another file named <span style="background-color: #CCE8FF">TestScript.flow</span> and its accompanying <span style="background-color: #CCE8FF">TestScript.msg</span> script will all be combined into your new field.bf. 
		</td>
		<td>
			<img src="http://i.imgur.com/V49pDcV.png">
		</td>
	</tr>
	<tr>
		<td><img src="http://i.imgur.com/awRqj6W.png"></td>
		<td id="left"><h2>Declaring variables</h2>
		<br>The next thing you're likely to see is a list of script-level variables that looks something like this:
		<br><span style="background-color: #CCE8FF">int variable30;
		<br>int variable31;
		<br>int variable32;</span>
		<br>Each of these begin with a type (in this case int) and a name (could be any word that doesn't start with a number). These are here if they will be used later in the script. They can't be given a value outside of a method.
		</td>
	</tr>
	<tr>
		<td>
			<h2>Methods</h2>
			<br>A method (also called a procedure) is a block of code that contains statements within curly brackets.
			<br><div style="background-color: #CCE8FF">void fld_right_menu()
			<br>{
			<br>}</div>
			<br>The above example is an example of a method. It starts with a type (void in this case), and then a name. At the end of the name is a set of parentheses (can be empty, used for parameters) and then a pair of curly brackets.
			
			<br><h3>Inside the brackets, you can...</h3>
			<span style="background-color: #CCE8FF">int number1;</span>
			<br>Declare new variables
			<br><span style="background-color: #CCE8FF">int number2 = 15;</span>
			<br>Initialize new variables
			<br><span style="background-color: #CCE8FF">variable31 = 2;</span>
			<br>Initialize script-level variables (notice how it doesn't need a type since it's already been declared before)
			<br><span style="background-color: #CCE8FF">number1 = (number2 * variable31);</span>
			<br>Do math
			<div style="background-color: #CCE8FF">bool variable10;
			<br>if (number1 >= 30)
			<br>{
			<br> variable10 = true;
			<br>}
			<br>else 
			<br>{
			<br> variable10 = false;
			<br>}</div>
			Do logical operations...
			<div style="background-color: #CCE8FF">bool variable10;
			<br>if (variable10 == true)
			<br>{
			<br> helloworld();
			<br>}</div>
			And most importantly, you can use other functions or methods within your method!
			<br><br>Why is this so important? Well, each game has a ton of functions that the scripts can use to
			make things happen. This includes: open a message window, make the player select a dialog choice,
			play an animation, set a flag, change the camera angle... The list goes on and on.
			<br><b><a href="https://github.com/TGEnigma/AtlusScriptToolchain/blob/d1e775b94c9e07b82e5c8f2676bafd5e3a565682/Source/AtlusScriptLib/Library/Registry/Persona5/Libraries/Field/Functions.json">A list of some of the functions and the parameters they require can be found here.</a></b>
		</td>
		<td>
			<img src="http://i.imgur.com/V49pDcV.png">
		</td>
	</tr>
</table>

</div>

<div class="content">
 
 <b><h1>Hello World!</h1></b>
 <table border="0" cellspacing="20" cellpadding="0" id="entry">
	<tr>
		<td>
			As our first example of using one of the game's functions, let's use <span style="background-color: #CCE8FF">MSG_WND_DSP();</span> to open the message window, <span style="background-color: #CCE8FF">MSG();</span> to display dialog from our .msg file, and <span style="background-color: #CCE8FF">MSG_WND_CLS();</span> to close the message window after the player gets past the message.
			<br>It'll look something like this in the flowscript:
			<br><div style="background-color: #CCE8FF">void helloworld()
			<br>{	
			<br> // Display the dialog window
			<br> MSG_WND_DSP(); 
			<br> // Display dialog
			<br> MSG( <b>HelloDialog</b>, 0 );
			<br> // Close the dialog window
			<br> MSG_WND_CLS();
			<br>}</div>
			Now, in the msgscript file, be sure <b>HelloDialog</b> is spelled and capitalized exactly the same:
			<br><div style="background-color: #CCE8FF">[dlg HelloDialog [Speaker Name]]
			<br>Hello world![w][e]</div>
			<br>Now you can put <b>helloworld();</b> in any method you want in your flowscript to display the dialog!
		</td>
		<td>
			<img src="https://media.discordapp.net/attachments/153593230024245248/353253118659657728/unknown.png?width=989&height=560">
		</td>
	<tr>
		<td><img src="https://i.imgur.com/bWxoKV0.png"></td>
		<td id="left">If you were to compile this, it'd look like the image to the left ingame.
		<br>As you can imagine, there are several potential uses for custom
		scripts and it's up to you to find them. The only limit to what you can do with this is your imagination, programming fluency, and patience.
		</td>
	</tr>
</table>
</div>

<div class="content">
<table border="0" cellspacing="20" cellpadding="0" id="entry">
	<tr>
		<td><h2>Creating branching dialog options</h2>
			From here, another useful thing to practice would be creating interactive menus.
			<br>By using the <span style="background-color: #CCE8FF">SEL(SelectionDialog);</span> function, the dialog choices menu will open with the list specified in your <span style="background-color: #CCE8FF">.msg</span> file (named <span style="background-color: #CCE8FF">SelectionDialog</span> in this example).
			<br><span style="background-color: #CCE8FF">SEL();</span> <b>returns an integer</b> which you could use in a <b>switch statement</b> to determine what happens next.
			<br><br>The flowscript would look something like this:
			<div style="background-color: #CCE8FF">void helloworld()
			<br>{	
			<br><span class="tab"></span> // Display the dialog window
			<br><span class="tab"></span> MSG_WND_DSP(); 
			<br><span class="tab"></span> // Display dialog
			<br><span class="tab"></span> MSG( <b>HelloDialog</b>, 0 );
			<br><span class="tab"></span> // Display the response options
			<br><span class="tab"></span> int selection = SEL(<b>SelectionDialog</b>);
			<br><span class="tab"></span> // Close the dialog window
			<br><span class="tab"></span> MSG_WND_CLS();
			<br>
			<br><span class="tab"></span>switch (selection)
			<br><span class="tab"></span>{
			<br><span class="tab"></span><span class="tab"></span>case 0:
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>//Stuff that happens if option 1 is picked
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>break;
			<br><span class="tab"></span><span class="tab"></span>case 1:
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>//Stuff that happens if option 2 is picked
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>break;
			<br><span class="tab"></span><span class="tab"></span>case 2:
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>//Stuff that happens if option 3 is picked
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>break;
			<br><span class="tab"></span><span class="tab"></span>default:
			<br><span class="tab"></span><span class="tab"></span><span class="tab"></span>break;
			<br><span class="tab"></span> }
			<br>}</div>
			And the msgscript part would look like this:
			<div style="background-color: #CCE8FF">[sel <b>SelectionDialog</b>]
			<br>1[e]
			<br>2[e]
			<br>3[e]</div>
		</td>
		<td><img src="http://i.imgur.com/JAKpRJy.png"></td>
	</tr>
</table>

</div>

<br><br>


</body>
</html>